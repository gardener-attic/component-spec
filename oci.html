

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Component Content in an OCI Registry &mdash; Gardener Component-Descriptor Contract and Specification  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Building Components" href="building_components.html" />
    <link rel="prev" title="Component Descriptor Registries" href="component_descriptor_registries.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Gardener Component-Descriptor Contract and Specification
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="motivation.html">Motivation and Scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Gardener Component Descriptor Semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="format.html">Gardener Component Descriptor Format Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="component_descriptor_registries.html">Component Descriptor Registries</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Component Content in an OCI Registry</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#storing-components">Storing Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-components-during-the-build">Creating Components during the Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cnudie-transport-format">CNUDIE Transport Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#component-archive">Component Archive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oci-artefact">OCI Artefact</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#oci-related-access-types">OCI related Access Types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="building_components.html">Building Components</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Gardener Component-Descriptor Contract and Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Component Content in an OCI Registry</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/oci.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="component-content-in-an-oci-registry">
<h1>Component Content in an OCI Registry<a class="headerlink" href="#component-content-in-an-oci-registry" title="Permalink to this heading">¶</a></h1>
<p>Component descriptors and local content delivered with a component are stored
in an OCI registry as OCI artefact. The component descriptor may describe
references to to other artefacts in any repository what type is supported
by an access type, regardless of the type of the artefact. There are dedicated
access types to refer to artefacts stored in an OCI registry.</p>
<div class="section" id="storing-components">
<h2>Storing Components<a class="headerlink" href="#storing-components" title="Permalink to this heading">¶</a></h2>
<p>The content of a component is stored in the OCI registry as OCI artefact of the
media type <code class="docutils literal notranslate"><span class="pre">application/vnd.gardener.cloud.cnudie.component.config.v1+json</span></code>.
Hereby the content consists at least of the component descriptor itself, which
is basically stored as blob described as first layer in the oci manifest.  The
media type is used as type for the config blob described in the oci manifest.
The blob confains a config json describing the digest of the component
descriptor blob (first layer).</p>
<p>The component descriptor blob uses the media type
<code class="docutils literal notranslate"><span class="pre">application/vnd.gardener.cloud.cnudie.component-descriptor.v2+json</span></code>.</p>
<p>Together with the component descriptor a set of artefacts local to the
component may be delivered. Those component local artefact blobs are stored as
additional layers of the appropriate media type. To describe the access to such
artefacts local to the component the component descriptor supports a dedicated
access type <code class="docutils literal notranslate"><span class="pre">LocalBlob</span></code> with the blob digest as reference name.</p>
</div>
<div class="section" id="creating-components-during-the-build">
<h2>Creating Components during the Build<a class="headerlink" href="#creating-components-during-the-build" title="Permalink to this heading">¶</a></h2>
<p>Typically versions for components are provided by builds.
To support this scenario thers is a contract between a build and a
component uploader tool.</p>
<p>The task of the build is then just to provide such a contract file
containing the generated component descriptor version with approriate
artefact and component referencen together with referenced blob artefacts.
To describe references to those local artefact blobs the
well-known access type <code class="docutils literal notranslate"><span class="pre">LocalBlob</span></code> is used.</p>
<p>A build may provide information for multiple components. For every provided
component version a component archive with the component descriptor and the
contained local blobs has to be provided. Those archives are then bundeled
in another fingle archive. THis archive is then the contract to the upload
tool. It is possible to call this tool directly in the build or the build system
defined a way to pass this archive to the build ecosystem which then carries
the repository credentials and handles the upload.</p>
<p>The same contract can be used for transporting repository content
via storage media between two environments. Therefore the transport tool
just need to provide a file based frontend and backend additional to
the regular repository to repository endpoints. This leads to the
specification of a general CNUDIE Transport Format (CTF).</p>
<p>The same contract and tooling can then be used for the build uploads and
regular transports.</p>
<img alt="_images/Build.png" src="_images/Build.png" />
</div>
<div class="section" id="cnudie-transport-format">
<h2>CNUDIE Transport Format<a class="headerlink" href="#cnudie-transport-format" title="Permalink to this heading">¶</a></h2>
<p>The transport format is based on tar archives (.tar or .tgz). There is one
archive per OCI artefact that should be included in the transport.</p>
<p>There will be two similar file system structures, one to describe component
artefact and one for describing regular standard OCI artefacts.</p>
<p>The final transport file is then just an archive (tar, tgz) containing the
artefact archives.</p>
<div class="section" id="component-archive">
<h3>Component Archive<a class="headerlink" href="#component-archive" title="Permalink to this heading">¶</a></h3>
<p>So far there is only a specification for the format for a component artefact.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── component-descriptor.yaml
└── blobs
    ├── blob1
    ├──  ...
    └── blobn
</pre></div>
</div>
<p>All the contained blobs (may use any name here) have to be referenced by the
local access type in the component descriptor.</p>
<p>The component descriptor must be the first entry in the tar archive to
support streaming.</p>
</div>
<div class="section" id="oci-artefact">
<h3>OCI Artefact<a class="headerlink" href="#oci-artefact" title="Permalink to this heading">¶</a></h3>
<p>A similar format for standard OCI Artefacts (including OCI Images as special case)
could look like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── artefact-descriptor.yaml
├── oci-manifest.json
└── blobs
    ├── blob1
    ├──  ...
    └── blobn
</pre></div>
</div>
<p>Like the component descriptor the additional file <code class="docutils literal notranslate"><span class="pre">artefact-descriptor.yaml</span></code>
described the artefact name and version. The other files are just taken
from the OCI artefact api. The blob names should be the correct OCI
digests used in the <code class="docutils literal notranslate"><span class="pre">oci-manifest.json</span></code>.</p>
<p>The artefact descriptor must be the first entry in the tar archive to
support streaming, followed by the oci manifest.</p>
</div>
</div>
<div class="section" id="oci-related-access-types">
<h2>OCI related Access Types<a class="headerlink" href="#oci-related-access-types" title="Permalink to this heading">¶</a></h2>
<p>To be able to describe access to artefacts stored in an OCU repository the
component descriptor supports several dedicated access types.
There are two ways to reference OCI stored artefacts:</p>
<ul class="simple">
<li><p>using the fully qualified access url to address artefacts stored in repositories different from the one hosting the using component descriptor.</p></li>
<li><p>using repository local names used to refer artefacts in the same repository. Supporting such local references enables the usage of technical replication tools for copying complete content of repositories without knowing about the component model and the structure of component descriptor files.</p></li>
</ul>
<p>Additionally there are two kinds of artefacts that have to be addressed in an
OCI registry:
- Direct blob artefacts (using the digest based blob access for a registry)
- OCI artefacts consisting of multiple blobs described by oci manifest.</p>
<p>For direct blobs there is also the possibility to store such artefacts directly
as part of the content of a component.</p>
<p>In summery there are therefor five access combinations, that are described by dedicated access types:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">OCIBlob</span></code></dt><dd><p>A fully qualified URL for accessing a blob using the OCI blob api using a
repository URL, a blob digest and a repository path.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">OCIArtefact</span></code></dt><dd><p>A fully qualified URL for accessing an OCI aretfact using the OCI artefact
api using a repository URL, a manifest digest/version and a respository path</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">RepositoryLocalOCIBlob</span></code></dt><dd><p>A path in the local repository (the artefact name) and the blob digest used
to access the blob via the OCI blob api in the repository hosting the
artefact reference.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">RepositoryLocalOCIArtefact</span></code></dt><dd><p>A path in the local repository (the artefact name) and the manifest digest
used to access the blob via the OCI artefact api in the repository hosting
the artefact reference.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">LocalBlob</span></code></dt><dd><p>The digest of the blob using the OCI blob api to access the blob as blob
nested to the actual component in the repository hosting the component
descriptor.</p>
</dd>
</dl>
<img alt="_images/Blob.png" src="_images/Blob.png" />
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="building_components.html" class="btn btn-neutral float-right" title="Building Components" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="component_descriptor_registries.html" class="btn btn-neutral float-left" title="Component Descriptor Registries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, The Gardener Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>